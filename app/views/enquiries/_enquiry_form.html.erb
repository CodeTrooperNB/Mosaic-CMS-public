<%
  pod_data ||= {} #initialize with empty hash if pod_data is nil

  # Extract pod data with defaults
  form_title ||= pod_data['form_title'] || 'Get In Touch'
  form_description ||= pod_data['form_description']
  show_phone ||= pod_data['show_phone'].nil? ? true : pod_data['show_phone']
  show_company ||= pod_data['show_company'] || false
  show_subject ||= pod_data['show_subject'].nil? ? true : pod_data['show_subject']
  message_label ||= pod_data['message_label'] || 'Message'
  message_placeholder ||= pod_data['message_placeholder'] || 'Tell us more about your enquiry...'
  submit_text ||= pod_data['submit_text'] || 'Send Message'
  success_message ||= pod_data['success_message'] || "Thank you! We'll get back to you soon."
  form_layout ||= pod_data['form_layout'] || 'single_column'
  background_color ||= pod_data['background_color'] || 'white'
  show_border ||= pod_data['show_border'].nil? ? true : pod_data['show_border']

  # Build CSS classes
  bg_class ||= case background_color
             when 'white' then 'bg-white'
             when 'gray-50' then 'bg-gray-50'
             when 'primary-50' then 'bg-primary-50'
             else ''
             end

  border_class ||= show_border ? 'border border-gray-200' : ''
%>

<div class="py-16 px-4 sm:px-6 lg:px-8" id="enquiry-form">
  <div class="max-w-3xl mx-auto">
    <div class="<%= bg_class %> <%= border_class %> rounded-lg shadow-sm p-8">
      <!-- Form Header -->
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold text-gray-900 mb-3"><%= form_title %></h2>
        <% if form_description.present? %>
          <div class="text-gray-600 text-lg">
            <%= raw form_description %>
          </div>
        <% end %>
      </div>

      <!-- Enquiry Form -->
      <%= form_with model: Enquiry.new, url: enquiries_path, local: true, data:{turbo_frames:"_top"}, class: "space-y-6" do |f| %>

        <!-- Name & Email Row (conditional layout) -->
        <div class="<%= form_layout == 'two_column' ? 'grid grid-cols-1 md:grid-cols-2 gap-6' : 'space-y-6' %>">
          <!-- Name Field -->
          <div>
            <%= f.label :name, "Name *", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :name,
                             required: true,
                             placeholder: "Your name",
                             class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" %>
          </div>

          <!-- Email Field -->
          <div>
            <%= f.label :email, "Email *", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.email_field :email,
                              required: true,
                              placeholder: "you@example.com",
                              class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" %>
          </div>
        </div>

        <!-- Phone Field (conditional) -->
        <% if show_phone %>
          <div>
            <%= f.label :phone, "Phone", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.telephone_field :phone,
                                  placeholder: "+1 (555) 123-4567",
                                  class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" %>
          </div>
        <% end %>

        <!-- Company Field (conditional) -->
        <% if show_company %>
          <div>
            <%= f.label :company, "Company", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :company,
                             placeholder: "Your company name",
                             class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" %>
          </div>
        <% end %>

        <!-- Subject Field (conditional) -->
        <% if show_subject %>
          <div>
            <%= f.label :subject, "Subject", class: "block text-sm font-medium text-gray-700 mb-1" %>
            <%= f.text_field :subject,
                             placeholder: "What is this regarding?",
                             class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition" %>
          </div>
        <% end %>

        <!-- Message Field -->
        <div>
          <%= f.label :message, "#{message_label} *", class: "block text-sm font-medium text-gray-700 mb-1" %>
          <%= f.text_area :message,
                          required: true,
                          rows: 6,
                          placeholder: message_placeholder,
                          class: "w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500 transition resize-y" %>
        </div>

        <!-- Honeypot Anti-Spam Field (hidden) -->
        <div class="hidden" aria-hidden="true">
          <%= f.text_field :website, tabindex: -1, autocomplete: "off" %>
        </div>

        <!-- Submit Button -->
        <div class="text-center pt-4">
          <%= f.submit submit_text,
                       class: "inline-flex items-center px-8 py-3 border border-transparent text-base font-medium rounded-lg text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200 cursor-pointer" %>
        </div>

        <!-- Success Message Display (hidden by default, shown via Turbo) -->
        <% if flash[:notice] %>
          <div class="mt-6 p-4 bg-green-50 border border-green-200 rounded-lg">
            <p class="text-green-800 text-center font-medium">
              <%= success_message %>
            </p>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</div>