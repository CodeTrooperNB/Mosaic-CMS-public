<li class="sortable-item group ml-2" data-id="<%= page.id %>">
  <div class="flex items-center justify-between py-2 px-3 rounded-md hover:bg-muted transition-colors">
    <div class="flex items-center gap-3 min-w-0 flex-1">
      <!-- Drag Handle -->
      <div class="drag-handle p-1 text-muted-foreground hover:text-card-foreground cursor-grab active:cursor-grabbing transition-colors"
           title="Drag to reorder">
        <%= action_icon("drag", class: "w-4 h-4") %>
      </div>

      <%= admin_icon("pages", class: "w-4 h-4 text-muted-foreground shrink-0") %>
      <%= link_to page.title, admin_page_path(page), class: "font-medium text-card-foreground truncate hover:text-primary transition-colors" %>

      <div class="flex items-center gap-2 shrink-0">
        <% if page.published? %>
          <span class="badge-success">
            <%= status_icon("published", class: "w-3 h-3") %>
            Live
          </span>
        <% else %>
          <span class="badge-info">
            <%= status_icon("draft", class: "w-3 h-3") %>
            Draft
          </span>
        <% end %>
        <span class="badge-info flex items-center gap-1">
          <%= admin_icon("pods", class: "w-3 h-3") %>
          <%= pluralize(page.page_pods.count, "Pod") %>
        </span>
      </div>
    </div>

    <div class="flex items-center gap-1">
      <%= link_to admin_page_path(page),
                  class: "p-1.5 text-muted-foreground hover:text-primary hover:bg-primary/10 rounded transition-colors",
                  title: "Edit page" do %>
        <%= action_icon("edit", class: "w-4 h-4") %>
      <% end %>
    </div>
  </div>

  <!-- Children Container -->
  <% children = pages_by_parent[page.id] || [] %>
  <% if children.any? %>
    <ul class="nested ml-6 mt-1 mb-[10px] space-y-1 min-h-[10px]" data-id="<%= page.id %>">
      <% children.each do |child_page| %>
        <%= render partial: 'node', locals: { page: child_page, pages_by_parent: pages_by_parent, level: level + 1 } %>
      <% end %>
    </ul>
  <% else %>
    <!-- Empty nested container for dropping -->
    <ul class="nested ml-6 mt-1 mb-[10px] min-h-[1px]" data-id="<%= page.id %>"></ul>
  <% end %>
</li>