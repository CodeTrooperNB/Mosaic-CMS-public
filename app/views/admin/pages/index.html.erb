<% content_for :page_title, "Pages" %>

<div id="page-index" class="space-y-6">
  <!-- Stats -->
  <div class="grid grid-cols-3 gap-4">
    <div class="bg-card border border-border rounded-lg p-4 hover:shadow-sm transition-shadow">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-xs font-medium text-muted-foreground uppercase tracking-wide">Total</div>
          <div class="text-2xl font-bold text-card-foreground"><%= @stats[:total_pages] %></div>
        </div>
        <%= admin_icon("pages", class: "w-8 h-8 text-muted-foreground") %>
      </div>
    </div>
    <div class="bg-card border border-border rounded-lg p-4 hover:shadow-sm transition-shadow">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-xs font-medium text-muted-foreground uppercase tracking-wide">Published</div>
          <div class="text-2xl font-bold text-success"><%= @stats[:published_pages] %></div>
        </div>
        <%= status_icon("published", class: "w-8 h-8 text-success") %>
      </div>
    </div>
    <div class="bg-card border border-border rounded-lg p-4 hover:shadow-sm transition-shadow">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-xs font-medium text-muted-foreground uppercase tracking-wide">Drafts</div>
          <div class="text-2xl font-bold text-warning"><%= @stats[:draft_pages] %></div>
        </div>
        <%= status_icon("draft", class: "w-8 h-8 text-warning") %>
      </div>
    </div>
  </div>

  <!-- Pages -->
  <div class="bg-card border border-border rounded-lg shadow-sm">
    <div class="flex items-center justify-between border-b border-border px-6 py-4">
      <div class="flex items-center gap-2">
        <%= admin_icon("pages", class: "w-5 h-5 text-muted-foreground") %>
        <h2 class="text-lg font-semibold text-card-foreground">All Pages</h2>
      </div>
      <%= link_to new_admin_page_path, class: "btn-primary-sm" do %>
        <%= action_icon("create", class: "w-4 h-4 text-white") %>
        New Page
      <% end %>
    </div>
    <div class="p-6" data-controller="admin--page-sorter">
      <% if @pages_by_parent.present? %>
        <div class="space-y-2">
          <% root_pages = @pages_by_parent[nil] || [] %>
          <% if root_pages.any? %>
            <ul class="space-y-1 nested tree" data-id="">
              <% root_pages.each do |page| %>
                <%= render partial: 'node', locals: { page: page, pages_by_parent: @pages_by_parent, level: 0 } %>
              <% end %>
            </ul>
          <% else %>
            <div class="text-center py-12">
              <%= admin_icon("pages", class: "w-12 h-12 text-muted-foreground mx-auto mb-4") %>
              <h3 class="text-lg font-medium text-card-foreground mb-2">No pages yet</h3>
              <p class="text-muted-foreground mb-4">Get started by creating your first page.</p>
              <%= link_to new_admin_page_path, class: "btn-primary" do %>
                <%= action_icon("create", class: "w-4 h-4") %>
                Create First Page
              <% end %>
              </ul>
            </div>
          <% end %>
        </div>
      <% end %>
    </div>
  </div>
</div>